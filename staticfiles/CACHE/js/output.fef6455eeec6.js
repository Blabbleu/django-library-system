let currentListSlug='';let currentBookId='';function openBookSelectionModal(slug){currentListSlug=slug;$('#bookSelectionModal').modal('show');}
function openRemoveBookModal(slug,bookId){currentListSlug=slug;currentBookId=bookId;$('#removeBookModal').modal('show');}
document.getElementById('bookSearchInput').addEventListener('input',function(){const query=this.value;fetch(`/books/query/?q=${query}`).then(response=>response.json()).then(data=>{const searchResults=document.getElementById('bookSearchResults');searchResults.innerHTML='';data.forEach(book=>{const bookCard=document.createElement('div');bookCard.className='search-book-card';bookCard.dataset.bookId=book.id;bookCard.innerHTML=`
                        <img src="${book.thumbnail}" alt="Thumbnail">
                        <div>
                            <p>${book.title} by ${book.author}</p>
                            <input type="checkbox" class="book-checkbox" data-book-id="${book.id}">
                        </div>
                    `;searchResults.appendChild(bookCard);});}).catch(error=>console.error('Error fetching search results:',error));});document.getElementById('selectBookButton').addEventListener('click',function(){const selectedBooks=document.querySelectorAll('.book-checkbox:checked');const bookIds=Array.from(selectedBooks).map(book=>book.dataset.bookId);if(bookIds.length>0){const promises=bookIds.map(bookId=>{return fetch(`/lists/${currentListSlug}/add/${bookId}/`,{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':''}}).then(response=>response.json());});Promise.all(promises).then(results=>{if(results.every(result=>result.success)){location.reload();}else{alert('Error adding some books to the list.');}});}else{alert('Please select at least one book.');}});document.getElementById('createListForm').addEventListener('submit',function(e){e.preventDefault();const formData=new FormData(this);fetch('/lists/',{method:'POST',headers:{'X-CSRFToken':''},body:formData}).then(response=>response.json()).then(data=>{if(data.success){location.reload();}else{alert('Error creating list.');}});});document.getElementById('confirmRemoveBookButton').addEventListener('click',function(){fetch(`/lists/${currentListSlug}/remove/${currentBookId}/`,{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':''}}).then(response=>response.json()).then(data=>{if(data.success){location.reload();}else{alert('Error removing the book from the list.');}});});;